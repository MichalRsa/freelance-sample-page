---
import { storyblokEditable } from "@storyblok/astro";
import SectionWrapper from "../components/SectionWrapper.astro";
import SectionTitle from "../components/SectionTitle.astro";
import LinkButton from "./LinkButton.astro";
import type { RatingStoryblok } from "../../component-types-sb";

interface Props {
  blok: RatingStoryblok;
  language: string;
}

const { blok, language } = Astro.props;
const rating = Number(blok.rating);

const starType = {
  full: "star_filled.png",
  half: "star_half_empty.png",
  empty: "star_empty.png",
};

const starArray: ("full" | "half" | "empty")[] = [];

for (let i = 1; i <= 5; i++) {
  if (i <= rating) starArray.push("full");
  else if (i - 0.5 <= rating) starArray.push("half");
  else starArray.push("empty");
}
---

<div {...storyblokEditable(blok)}>
  <SectionWrapper bgColor={blok.background_color}>
    <SectionTitle title={blok.title} classes="text-center" />
    <p class="text-center font-lora text-xl font-medium md:text-5xl">
      {rating}
    </p>
    <div class="flex justify-center pb-4">
      {starArray.map((star) => <img src=`/${starType[star]}` width="80" height="80" />)}
    </div>
    <div class="flex justify-center">
      {blok.cta?.[0] && <LinkButton language={language} blok={blok.cta[0]} />}
    </div>
  </SectionWrapper>
</div>
